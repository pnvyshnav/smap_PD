# SMAP Evaluation

This components is used for generating plots from the [smapStats](./msg/smapStats.msg) bag file
generated by [Statistics.cpp](./src/Statistics.cpp).

## Full Error (MAE) Evolution

Experiments with different observation noise std deviations compared to Log-Odds-based mapping:
![Full Error](./plots/fullerror.png?raw=true)

Error evolution for the noise std deviations from the ICRA 2016 paper:
![Full Error](./plots/fullerror_paper_stds.png?raw=true)

Even for very intensive noise levels like std=0.5 (voxel size is only 0.125),
SMAP ultimately converges and outperforms Log Odds:
![High Noise](./plots/high_noise_convergence_fullerror.png)

## Distribution of Errors

To get better insights, how belief or Log Odds are updated at every step, in the following,
only the *updated* voxels are considered
that lie on the ray from the sensor position up until (and including) the first *occupied* voxel.

The following diagram visualizes the histogram of errors at every step.
1600 steps were executed which equates to 22.22 full rotations of the robot in the environment
(this explains periodic patterns in the plots).
The white line shows the average error of the updated voxels.
Note how Log Odds errors are clustered along a line at about 0.12.
After trying many different ISM parameters, it was not possible to improve Log Odds in the way that more errors
would be distributed below this cluster.
![Histogram Evolution](./plots/error_histogram_evolution.png)

## Analysis of Mean and Variance

The following plot shows the average difference of 1, 2 and 3 standard deviations minus voxel mean.

![Difference Error and Std Dev](./plots/difference_from_error_to_std.png)

Another error metric that takes into account mean and variance is the Root Mean Square Error (RMSE).
It is computed as 1/n * sqrt(μ² + σ²) for each voxel mean μ and std dev σ over n voxels.

### RMSE over all voxels:
![RSME all voxels](./plots/rmse_evolution_over_all_voxels.png)

### RMSE over only the updated voxels at every step:
![RSME only updated voxels](./plots/root_mean_square_error_(rmse)_evolution_over_all_voxels.png
)

## Correlation between Error and Variance
The variance computed for each voxel should give insights into the confidence of the occupancy estimation.
The larger the variance, the greater is the expected error. The following plot shows the correlation between
SMAP's belief voxel Gaussian variance / Log Odds' Bernoulli variance, and the absolute error over all updated voxels
at each step.

![Correlation](./plots/correlation_of_error_and_variance.png)

The following plot shows error (blue) and +/- 2 std devs (red) for all _updated_ voxels at the first step of the simulation, inconsistencies (error > 2 std dev) are marked green:
![Mean and Variance](./plots/inconsistencies_at_first_step.png)

The following plot shows error (blue) and +/- 2 std devs (red) for all _updated_ voxels at the last step of the simulation, inconsistencies (error > 2 std dev) are marked green:
![Mean and Variance](./plots/inconsistencies_at_last_step.png)

I also tried to first round the error of each voxel before testing whether the deviation exceeds one standard deviation.
Since the rounded absolute error is either 0 or 1, the following plot is actually showing the evolution of cases where
the voxel was wrongly estimated to be free or occupied. It shows a similar curve to the error evolution from above.
![Inconsistencies](./plots/rounded_errors_outside_std_interval.png)
